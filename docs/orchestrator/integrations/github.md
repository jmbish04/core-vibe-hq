

# **ü§ñ GitHub Orchestrator Client (integrations/github.ts)**

This document provides an overview and API reference for the **GitHubOrchestratorClient**, the primary TypeScript client used by the orchestrator service to interact with GitHub for automated DevOps and agentic workflows.  
The client connects to your self-hosted API gateway, https://core-github-api.hacolby.workers.dev/, and is explicitly designed to support **Codex Auto Mode** by providing a high-level control plane over GitHub resources.  
---

## **üöÄ Setup and Initialization**

The client requires two environment variables, which should be configured in your Cloudflare Worker environment (e.g., in wrangler.jsonc or via the dashboard).

### **Environment Requirements**

| Variable Name | Description | Purpose |
| :---- | :---- | :---- |
| CORE\_GITHUB\_API\_URL | The base URL of your GitHub API proxy worker. | https://core-github-api.hacolby.workers.dev |
| GITHUB\_API\_TOKEN | A **Fine-Grained Personal Access Token (PAT)** or GitHub App Installation Token with appropriate scopes. | Authentication for all API calls. |

### **Client Class Structure**

The client is instantiated in the orchestrator with the environment:

TypeScript

// Example instantiation within a worker service  
import { GitHubOrchestratorClient, GitHubClientEnv } from './integrations/github';

// Assuming Env is your worker environment object  
const githubClient \= new GitHubOrchestratorClient(env as GitHubClientEnv);

---

## **üõ†Ô∏è Key API Reference for Autonomous Operations**

The methods are grouped below by their functional area, empowering your agents to manage the full development lifecycle from planning (Issues) to deployment (Actions & Configuration).

### **I. Issues & Pull Request Management**

These methods are used for planning, triaging, and collaborating on code changes generated by agents.

| Method | Description | Path/Operation |
| :---- | :---- | :---- |
| listIssues | Retrieves a list of issues for a repository (open, closed, or all). | GET /repos/{owner}/{repo}/issues |
| createIssue | Creates a new issue. | POST /repos/{owner}/{repo}/issues |
| updateIssue | Modifies an issue's title, body, or state (open/closed). | PATCH /repos/{owner}/{repo}/issues/{num} |
| listPullRequests | Lists all pull requests. | GET /repos/{owner}/{repo}/pulls |
| createPullRequest | Creates a new pull request between two branches. | POST /repos/{owner}/{repo}/pulls |
| updatePullRequest | Updates a pull request (title, body, state). | PATCH /repos/{owner}/{repo}/pulls/{num} |
| createPullRequestReviewComment | **Automated Code Review:** Adds a line-level code comment on a PR. | POST /repos/{owner}/{repo}/pulls/{num}/comments |
| replyToPullRequestComment | Replies to an existing code comment. | POST /.../comments/{id}/replies |

---

### **II. Git Data (Branches & Tags) and Content**

Core methods for reading repository content and managing the Git structure, essential for agent code generation and deployment.

| Method | Description | Path/Operation |
| :---- | :---- | :---- |
| createGitRef | **Branching:** Creates a new Git reference (e.g., a feature branch or tag). | POST /repos/{owner}/{repo}/git/refs |
| deleteGitRef | Deletes a Git reference (e.g., cleaning up a merged feature branch). | DELETE /repos/{owner}/{repo}/git/refs/{ref} |
| getFileContentsRaw | Retrieves the **unencoded, raw content** of a file as a string. | GET /repos/{owner}/{repo}/contents/{path} (Raw Accept header) |
| createOrUpdateFile | Creates or updates a file in the repository (requires **Base64** encoded content and sha for updates). | PUT /repos/{owner}/{repo}/contents/{path} |
| listTags | Lists all Git tags in the repository. | GET /repos/{owner}/{repo}/tags |

---

### **III. Repository Configuration & Governance**

These methods are crucial for **enforcing security and integration standards** for new services bootstrapped by your agents.

| Method | Description | Path/Operation |
| :---- | :---- | :---- |
| createRepository | Creates a new repository (user or org). | POST /user/repos or POST /orgs/{org}/repos |
| setBranchProtection | **Governance:** Enforces required status checks and review counts on branches like main. | PUT /repos/{owner}/{repo}/branches/{branch}/protection |
| createWebhook | Creates a new repository webhook for external event listeners. | POST /repos/{owner}/{repo}/hooks |
| replaceAllTopics | Sets or replaces all topics/tags on the repository. | PUT /repos/{owner}/{repo}/topics |

---

### **IV. CI/CD Pipeline Control (Actions, Status, Releases)**

Direct control over the CI/CD lifecycle, enabling external status reporting and autonomous deployments via GitHub Actions.

| Method | Description | Path/Operation |
| :---- | :---- | :---- |
| triggerWorkflowDispatch | **Codex Auto Mode Core:** Initiates a GitHub Actions workflow manually. | POST /.../workflows/{id}/dispatches |
| setCommitStatus | Sets an external CI/CD tool status (success, pending, failure) on a commit SHA. | POST /repos/{owner}/{repo}/statuses/{sha} |
| createRelease | Creates a formal GitHub Release for versioned deployments. | POST /repos/{owner}/{repo}/releases |
| getRepositoryPublicKey | Fetches the public key needed for secret encryption. | GET /repos/{owner}/{repo}/actions/secrets/public-key |
| createOrUpdateRepositorySecret | **Secures Credentials:** Uploads an **encrypted** GitHub Actions secret. | PUT /repos/{owner}/{repo}/actions/secrets/{name} |

---

### **V. Issue Triage and Metadata**

Methods to organize and route work automatically within your project tracker.

| Method | Description | Path/Operation |
| :---- | :---- | :---- |
| createLabel | Creates a new project label. | POST /repos/{owner}/{repo}/labels |
| addLabelsToIssue | Adds one or more labels to an issue or PR. | POST /repos/{owner}/{repo}/issues/{num}/labels |
| setAssignees | Assigns specific users to an issue or PR. | POST /repos/{owner}/{repo}/issues/{num}/assignees |

---

## **‚ö†Ô∏è Important Security Note: Secret Encryption**

The GitHub API requires that any new repository or organization secrets created via the API (using createOrUpdateRepositorySecret) must be **encrypted client-side** before transmission.  
**Your orchestrator agent must perform the following steps:**

1. Call getRepositoryPublicKey(owner, repo) to retrieve the key and key\_id.  
2. Use a library like [**libsodium-wrappers**](https://www.google.com/search?q=https://github.com/jedisct1/libsodium.js) to encrypt the secret value using the retrieved public key.  
3. Send the **Base64-encoded encrypted value** and the key\_id to the createOrUpdateRepositorySecret method.

Failing to encrypt the secret will result in an API rejection. This is a security feature mandated by GitHub, not a limitation of this client.